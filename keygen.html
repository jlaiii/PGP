window.generateKeys = async function () {
  try {
    const { privateKey, publicKey } = await openpgp.generateKey({
      type: 'rsa',
      rsaBits: 2048,
      format: 'armored',
      userIDs: [{ name: 'User', email: 'user@example.com' }]
    });

    document.getElementById('publicKey').value = publicKey;
    document.getElementById('privateKey').value = privateKey;
  } catch (error) {
    console.error('Key generation failed:', error);
    alert('Failed to generate keys. See console for details.');
  }
};

window.togglePrivateKey = function () {
  const privateKeyArea = document.getElementById('privateKey');
  privateKeyArea.classList.toggle('hidden');
};

window.saveAsJSON = function () {
  const publicKey = document.getElementById('publicKey').value;
  const privateKey = document.getElementById('privateKey').value;

  if (!publicKey || !privateKey) {
    alert('Please generate keys first.');
    return;
  }

  const data = { publicKey, privateKey };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'pgp_keys.json';
  a.click();
  URL.revokeObjectURL(url);
};
